<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anesthesia Congress Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #020617;
      --card-bg: #020617;
      --muted: #94a3b8;
      --border-subtle: rgba(148, 163, 184, 0.25);
      --text: #e2e8f0;
      --text-strong: #f9fafb;

      /* Series colors */
      --series-asa: #0f766e;
      --series-esaic: #1d4ed8;
      --series-esra: #7c3aed;
      --series-wca: #b91c1c;
      --series-larac: #15803d;
      --series-soc: #9333ea;
      --series-other: #4b5563;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 24px 12px;
    }

    .page {
      width: 100%;
      max-width: 880px;
    }

    header {
      margin-bottom: 24px;
    }

    .title-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: baseline;
      justify-content: space-between;
    }

    h1 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--text-strong);
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .subtitle {
      margin-top: 4px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.78rem;
      color: var(--muted);
      align-items: center;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(12px);
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .legend-dot-asa {
      background: var(--series-asa);
    }
    .legend-dot-esaic {
      background: var(--series-esaic);
    }
    .legend-dot-esra {
      background: var(--series-esra);
    }
    .legend-dot-wca {
      background: var(--series-wca);
    }
    .legend-dot-larac {
      background: var(--series-larac);
    }
    .legend-dot-soc {
      background: var(--series-soc);
    }
    .legend-dot-other {
      background: var(--series-other);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    .filters select {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text);
      font-size: 0.82rem;
      padding: 6px 28px 6px 10px;
      appearance: none;
    }

    .filters select:focus {
      outline: 2px solid #38bdf8;
      outline-offset: 1px;
    }

    main {
      border-radius: 18px;
      padding: 14px 10px 8px;
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top left, #020617 0, #020617 80%);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(26px);
    }

    .events-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Entire card is the link */
    .event-card {
      display: block;
      text-decoration: none;
      color: inherit;
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background: rgba(15, 23, 42, 0.96);
      position: relative;
      overflow: hidden;
      transition:
        transform 120ms ease-out,
        box-shadow 120ms ease-out,
        border-color 120ms ease-out,
        background 120ms ease-out;
      cursor: pointer;
    }

    .event-card::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.08;
      background: radial-gradient(
        circle at top left,
        rgba(248, 250, 252, 0.4),
        transparent 55%
      );
      pointer-events: none;
    }

    .event-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.85);
      border-color: rgba(15, 23, 42, 0.9);
    }

    .event-card:active {
      transform: translateY(0);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
    }

    /* Color pills by series */
    .series-colored {
      color: #f9fafb;
    }

    .series-asa {
      background: linear-gradient(90deg, #0f766e, #0e7490);
    }

    .series-esaic {
      background: linear-gradient(90deg, #1d4ed8, #0ea5e9);
    }

    .series-esra {
      background: linear-gradient(90deg, #7c3aed, #a855f7);
    }

    .series-wca {
      background: linear-gradient(90deg, #b91c1c, #f97316);
    }

    .series-larac {
      background: linear-gradient(90deg, #15803d, #22c55e);
    }

    .series-soc {
      background: linear-gradient(90deg, #9333ea, #db2777);
    }

    .series-other {
      background: linear-gradient(90deg, #4b5563, #6b7280);
    }

    .event-inner {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 1;
    }

    .event-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .event-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      font-size: 0.78rem;
    }

    .event-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.35);
      border: 1px solid rgba(15, 23, 42, 0.55);
      white-space: nowrap;
    }

    .event-chip.event-date-main {
      font-weight: 500;
      background: rgba(15, 23, 42, 0.3);
      border-color: rgba(15, 23, 42, 0.6);
    }

    .event-chip-label {
      opacity: 0.9;
    }

    .event-chip-badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.55);
      background: rgba(15, 23, 42, 0.55);
    }

    .empty-state {
      padding: 16px 12px;
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
    }

    @media (max-width: 640px) {
      body {
        padding: 16px 10px;
      }

      main {
        padding: 10px 8px 6px;
      }

      .event-card {
        border-radius: 16px;
      }

      .title-row {
        gap: 4px;
      }

      h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title-row">
        <h1>Anesthesia Congress Calendar</h1>
      </div>
      <p class="subtitle">
        A compact view of major anesthesia congresses, courses, and deadlines ‚Äî color-coded by series.
      </p>

      <div class="controls-row">
        <div class="legend">
          <span class="legend-item">
            <span class="legend-dot legend-dot-asa"></span> ASA
          </span>
          <span class="legend-item">
            <span class="legend-dot legend-dot-esaic"></span> ESAIC / Euroanesthesia
          </span>
          <span class="legend-item">
            <span class="legend-dot legend-dot-esra"></span> ESRA
          </span>
          <span class="legend-item">
            <span class="legend-dot legend-dot-wca"></span> WCA
          </span>
          <span class="legend-item">
            <span class="legend-dot legend-dot-larac"></span> LARAC / regional
          </span>
          <span class="legend-item">
            <span class="legend-dot legend-dot-other"></span> Other
          </span>
        </div>

        <div class="filters">
          <select id="yearFilter">
            <option value="all">All years</option>
          </select>
          <select id="seriesFilter">
            <option value="all">All series</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <div id="eventsList" class="events-list"></div>
      <div id="emptyState" class="empty-state" style="display: none;">
        No events match the current filters.
      </div>
    </main>
  </div>

  <script>
    // --- Helpers ---

    function parseISODate(iso) {
      if (!iso) return null;
      var parts = iso.split("-");
      return new Date(+parts[0], +parts[1] - 1, +parts[2]);
    }

    function formatEventDateRange(ev) {
      var start = parseISODate(ev.date);
      var end = ev.end_date ? parseISODate(ev.end_date) : null;
      if (!start) return "";

      var opts = { day: "2-digit", month: "2-digit", year: "numeric" };
      var startStr = start.toLocaleDateString("pt-BR", opts);
      var rangeStr = startStr;

      if (end) {
        var endStr = end.toLocaleDateString("pt-BR", opts);
        rangeStr = startStr + "‚Äì" + endStr;
      }

      var today = new Date();
      var todayMid = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      var msPerDay = 24 * 60 * 60 * 1000;
      var diffDays = Math.round((start - todayMid) / msPerDay);

      var suffix = "";
      if (diffDays === 0) {
        suffix = " ‚Ä¢ today";
      } else if (diffDays > 0) {
        suffix = " ‚Ä¢ in " + diffDays + " day" + (diffDays === 1 ? "" : "s");
      } else {
        var a = Math.abs(diffDays);
        suffix = " ‚Ä¢ " + a + " day" + (a === 1 ? "" : "s") + " ago";
      }

      return rangeStr + suffix;
    }

    function normalizeSeriesSlug(series) {
      if (!series) return "other";
      return series.toString().trim().toLowerCase();
    }

    // Congress first, other events, then deadlines
    function eventTypePriority(ev) {
      var t = (ev.type || "").toLowerCase();
      if (t === "congress" || t === "main_congress" || t === "main") return 0;
      if (t.indexOf("deadline") !== -1) return 2;
      return 1; // everything else
    }

    function sortEvents(events) {
      return events.slice().sort(function (a, b) {
        var pa = eventTypePriority(a);
        var pb = eventTypePriority(b);
        if (pa !== pb) return pa - pb;

        var da = a.date || "";
        var db = b.date || "";
        if (da !== db) return da.localeCompare(db);

        var prA = typeof a.priority === "number" ? -a.priority : 0;
        var prB = typeof b.priority === "number" ? -b.priority : 0;
        if (prA !== prB) return prA - prB;

        var titleA =
          (a.title && (a.title.en || a.title.pt)) ||
          a.title ||
          "";
        var titleB =
          (b.title && (b.title.en || b.title.pt)) ||
          b.title ||
          "";
        return titleA.localeCompare(titleB);
      });
    }

    function buildFilters(events) {
      var yearSelect = document.getElementById("yearFilter");
      var seriesSelect = document.getElementById("seriesFilter");

      var yearSet = {};
      var seriesSet = {};

      events.forEach(function (ev) {
        if (ev.year) yearSet[ev.year] = true;
        var s = ev.series || "Other";
        seriesSet[s] = true;
      });

      Object.keys(yearSet)
        .sort()
        .forEach(function (y) {
          var opt = document.createElement("option");
          opt.value = String(y);
          opt.textContent = y;
          yearSelect.appendChild(opt);
        });

      Object.keys(seriesSet)
        .sort()
        .forEach(function (s) {
          var opt = document.createElement("option");
          opt.value = s;
          opt.textContent = s;
          seriesSelect.appendChild(opt);
        });
    }

    function passesFilters(ev, yearFilter, seriesFilter) {
      if (yearFilter !== "all" && String(ev.year) !== yearFilter) return false;
      if (seriesFilter !== "all" && (ev.series || "Other") !== seriesFilter)
        return false;
      return true;
    }

    function renderEvents(events) {
      var listEl = document.getElementById("eventsList");
      var emptyEl = document.getElementById("emptyState");
      listEl.innerHTML = "";

      var yearFilter = document.getElementById("yearFilter").value;
      var seriesFilter = document.getElementById("seriesFilter").value;

      var filtered = events.filter(function (ev) {
        return passesFilters(ev, yearFilter, seriesFilter);
      });

      if (!filtered.length) {
        emptyEl.style.display = "block";
        return;
      }
      emptyEl.style.display = "none";

      filtered.forEach(function (ev) {
        var seriesSlug = normalizeSeriesSlug(ev.series);
        var seriesClass = "series-" + seriesSlug;
        var allowed =
          [
            "series-asa",
            "series-esaic",
            "series-esra",
            "series-wca",
            "series-larac",
            "series-soc",
          ].indexOf(seriesClass) !== -1
            ? seriesClass
            : "series-other";

        var link = document.createElement("a");
        link.className = "event-card series-colored " + allowed;
        link.href = ev.link || "#";
        if (ev.link) {
          link.target = "_blank";
          link.rel = "noreferrer noopener";
        }

        var inner = document.createElement("div");
        inner.className = "event-inner";

        var titleDiv = document.createElement("div");
        titleDiv.className = "event-title";
        var titleText =
          (ev.title && (ev.title.en || ev.title.pt)) ||
          ev.title ||
          "(untitled event)";
        titleDiv.textContent = titleText;

        var metaRow = document.createElement("div");
        metaRow.className = "event-meta-row";

        // Main date (congress date first)
        var dateChip = document.createElement("span");
        dateChip.className = "event-chip event-date-main";
        dateChip.textContent = formatEventDateRange(ev);
        metaRow.appendChild(dateChip);

        // Series/year
        var seriesChip = document.createElement("span");
        seriesChip.className = "event-chip";
        seriesChip.innerHTML =
          '<span class="event-chip-label">' +
          (ev.series || "Other").toUpperCase() +
          " ¬∑ " +
          (ev.year || "") +
          "</span>";
        metaRow.appendChild(seriesChip);

        // Type chip
        if (ev.type) {
          var label;
          var t = ev.type.toLowerCase();
          if (t === "congress" || t === "main_congress" || t === "main")
            label = "Congress";
          else if (t.indexOf("deadline") !== -1)
            label = "Deadline";
          else if (t.indexOf("course") !== -1)
            label = "Course";
          else if (t.indexOf("workshop") !== -1)
            label = "Workshop";
          else label = ev.type;

          var typeChip = document.createElement("span");
          typeChip.className = "event-chip";
          typeChip.innerHTML =
            '<span class="event-chip-badge">' + label + "</span>";
          metaRow.appendChild(typeChip);
        }

        // Location chip
        if (ev.location) {
          var locChip = document.createElement("span");
          locChip.className = "event-chip";
          locChip.innerHTML =
            '<span class="event-chip-label">üìç ' +
            ev.location +
            "</span>";
          metaRow.appendChild(locChip);
        }

        inner.appendChild(titleDiv);
        inner.appendChild(metaRow);
        link.appendChild(inner);
        listEl.appendChild(link);
      });
    }

    // --- Init ---

    document.addEventListener("DOMContentLoaded", function () {
      fetch("events.json", { cache: "no-store" })
        .then(function (res) {
          if (!res.ok) throw new Error("Failed to load events.json");
          return res.json();
        })
        .then(function (data) {
          var events = Array.isArray(data.events) ? data.events : data;
          var sorted = sortEvents(events);
          buildFilters(sorted);
          renderEvents(sorted);

          document
            .getElementById("yearFilter")
            .addEventListener("change", function () {
              renderEvents(sorted);
            });
          document
            .getElementById("seriesFilter")
            .addEventListener("change", function () {
              renderEvents(sorted);
            });
        })
        .catch(function (err) {
          console.error(err);
          var listEl = document.getElementById("eventsList");
          var emptyEl = document.getElementById("emptyState");
          emptyEl.style.display = "block";
          emptyEl.textContent =
            "Could not load events. Check if events.json is present in the repository root.";
          listEl.innerHTML = "";
        });
    });
  </script>
</body>
</html>